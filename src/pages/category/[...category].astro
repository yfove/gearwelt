---
import CategoryLayout from "../../layouts/CategoryLayout.astro";

export async function getStaticPaths() {
const allPosts = await Astro.glob("../../pages/**/**/*.mdx");

const allTags = new Set();
allPosts.forEach((post) => {
(post.frontmatter.tags || []).forEach((tag) => allTags.add(tag.toLowerCase()));
});

return Array.from(allTags).map((tag) => ({
params: { category: tag }
}));
}

const { category } = Astro.params;
const allPosts = await Astro.glob("../../pages/**/**/*.mdx");

const filteredPosts = allPosts.filter((post) =>
(post.frontmatter.tags || []).some(
(tag) => tag.toLowerCase() === category.toLowerCase()
)
);
---

<CategoryLayout title={category.charAt(0).toUpperCase() + category.slice(1)} posts={filteredPosts} />