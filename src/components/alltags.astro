---
const allPosts = await Astro.glob("../pages/post/**/*.mdx");

// Normalize tags to lowercase and get unique set
const tags = [
...new Set(
allPosts.flatMap(post => (post.frontmatter.tags || []).map(tag => tag.toLowerCase()))
),
];

const maxVisibleTags = 15;
---

<div class="tags flex flex-wrap justify-start gap-2 my-3">
  <div id="tagsContainer" class="flex flex-wrap gap-2">
    {tags
    .sort((a, b) => a.localeCompare(b))
    .slice(0, maxVisibleTags)
    .map(tag => (
    <p key={tag}
      class="tag border-2 border-stone-900 bg-black px-4 py-1 font-bold text-white text-sm hover:text-gray-100">
      <a href={`/tags/${tag}`} class="font-sans font-bold">{tag}</a>
    </p>
    ))
    }
  </div>

  {tags.length > maxVisibleTags && (
  <button id="toggleTags"
    class="mt-2 border-2 border-stone-900 bg-secondary px-4 py-1 font-bold text-black text-sm hover:text-gray-700"
    data-tags={JSON.stringify(tags)}>
    Show all tags
  </button>
  )}
</div>

<script>
  const toggleButton = document.getElementById('toggleTags');
  const tagsContainer = document.getElementById('tagsContainer');

  if (toggleButton) {
    const allTags = JSON.parse(toggleButton.dataset.tags); // get tags from data attribute
    const maxVisible = 15;
    let expanded = false;

    const renderTags = (tagsToRender) => {
      tagsContainer.innerHTML = tagsToRender
        .map(tag => `<p class="tag border-2 border-stone-900 bg-black px-4 py-1 font-bold text-white text-sm hover:text-gray-100">
                        <a href="/tags/${tag}" class="font-sans font-bold">${tag}</a>
                      </p>`).join('');
    };

    toggleButton.addEventListener('click', () => {
      expanded = !expanded;
      renderTags(expanded ? allTags.sort() : allTags.sort().slice(0, maxVisible));
      toggleButton.textContent = expanded ? 'Collapse tags' : 'Show all tags';
    });
  }
</script>